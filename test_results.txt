============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- c:\Users\bjlol\Desktop\ai-agent-observatory\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\bjlol\Desktop\ai-agent-observatory
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 157 items

tests/unit/services/test_cache_service.py::TestCacheSummaryEmpty::test_empty_calls_returns_valid_response PASSED [  0%]
tests/unit/services/test_cache_service.py::TestCacheHitRate::test_calculates_cache_hit_rate PASSED [  1%]
tests/unit/services/test_cache_service.py::TestCacheHitRate::test_no_cache_metadata PASSED [  1%]
tests/unit/services/test_cache_service.py::TestDuplicateDetection::test_identifies_duplicate_prompts PASSED [  2%]
tests/unit/services/test_cache_service.py::TestDuplicateDetection::test_case_insensitive_matching PASSED [  3%]
tests/unit/services/test_cache_service.py::TestDuplicateDetection::test_whitespace_normalization FAILED [  3%]
tests/unit/services/test_cache_service.py::TestDetailTable::test_groups_by_operation PASSED [  4%]
tests/unit/services/test_cache_service.py::TestDetailTable::test_counts_unique_prompts PASSED [  5%]
tests/unit/services/test_cache_service.py::TestDetailTable::test_calculates_redundancy_percentage PASSED [  5%]
tests/unit/services/test_cache_service.py::TestDetailTable::test_status_indicators FAILED [  6%]
tests/unit/services/test_cache_service.py::TestDetailTable::test_sorted_by_wasted_cost PASSED [  7%]
tests/unit/services/test_cache_service.py::TestWastedCostCalculation::test_calculates_wasted_cost PASSED [  7%]
tests/unit/services/test_cache_service.py::TestTopOffender::test_identifies_highest_wasted_cost PASSED [  8%]
tests/unit/services/test_cache_service.py::TestTopOffender::test_top_offender_includes_diagnosis PASSED [  8%]
tests/unit/services/test_cache_service.py::TestTopOffender::test_no_top_offender_without_opportunities PASSED [  9%]
tests/unit/services/test_cache_service.py::TestHealthScore::test_perfect_health_with_good_hit_rate FAILED [ 10%]
tests/unit/services/test_cache_service.py::TestHealthScore::test_health_degrades_with_opportunities PASSED [ 10%]
tests/unit/services/test_cache_service.py::TestHealthScore::test_status_based_on_hit_rate PASSED [ 11%]
tests/unit/services/test_cache_service.py::TestChartData::test_chart_data_limited_to_10 PASSED [ 12%]
tests/unit/services/test_cache_service.py::TestChartData::test_chart_data_structure PASSED [ 12%]
tests/unit/services/test_cache_service.py::TestCacheOpportunityThreshold::test_threshold_detection PASSED [ 13%]
tests/unit/services/test_cost_service.py::test_cost_service PASSED       [ 14%]
tests/unit/services/test_latency_service.py::TestLatencySummaryEmpty::test_empty_calls_returns_valid_response PASSED [ 14%]
tests/unit/services/test_latency_service.py::TestLatencySummaryEmpty::test_empty_calls_has_no_recommendations PASSED [ 15%]
tests/unit/services/test_latency_service.py::TestLatencySummaryBasic::test_single_fast_call PASSED [ 15%]
tests/unit/services/test_latency_service.py::TestLatencySummaryBasic::test_calculates_correct_average PASSED [ 16%]
tests/unit/services/test_latency_service.py::TestLatencyThresholds::test_warning_threshold_detection PASSED [ 17%]
tests/unit/services/test_latency_service.py::TestLatencyThresholds::test_critical_threshold_detection PASSED [ 17%]
tests/unit/services/test_latency_service.py::TestLatencyThresholds::test_mixed_thresholds PASSED [ 18%]
tests/unit/services/test_latency_service.py::TestLatencyDetailTable::test_detail_table_groups_by_operation PASSED [ 19%]
tests/unit/services/test_latency_service.py::TestLatencyDetailTable::test_detail_table_sorted_by_latency PASSED [ 19%]
tests/unit/services/test_latency_service.py::TestLatencyDetailTable::test_detail_table_includes_call_count PASSED [ 20%]
tests/unit/services/test_latency_service.py::TestLatencyDetailTable::test_detail_table_status_indicators PASSED [ 21%]
tests/unit/services/test_latency_service.py::TestTopOffender::test_top_offender_identifies_slowest PASSED [ 21%]
tests/unit/services/test_latency_service.py::TestTopOffender::test_top_offender_includes_diagnosis PASSED [ 22%]
tests/unit/services/test_latency_service.py::TestTopOffender::test_no_top_offender_when_all_fast PASSED [ 22%]
tests/unit/services/test_latency_service.py::TestChartData::test_chart_data_limited_to_10 PASSED [ 23%]
tests/unit/services/test_latency_service.py::TestChartData::test_chart_data_structure PASSED [ 24%]
tests/unit/services/test_latency_service.py::TestHealthScore::test_perfect_health_no_issues PASSED [ 24%]
tests/unit/services/test_latency_service.py::TestHealthScore::test_health_degrades_with_warnings PASSED [ 25%]
tests/unit/services/test_latency_service.py::TestHealthScore::test_health_degrades_more_with_critical PASSED [ 26%]
tests/unit/services/test_latency_service.py::TestHealthScore::test_health_floors_at_zero PASSED [ 26%]
tests/unit/services/test_latency_service.py::TestDiagnosis::test_diagnoses_high_completion_tokens PASSED [ 27%]
tests/unit/services/test_latency_service.py::TestDiagnosis::test_diagnoses_large_prompt PASSED [ 28%]
tests/unit/services/test_latency_service.py::TestLatencyFormatting::test_formats_milliseconds PASSED [ 28%]
tests/unit/services/test_latency_service.py::TestLatencyFormatting::test_formats_seconds PASSED [ 29%]
tests/unit/services/test_optimization_service.py::TestOptimizationSummaryEmpty::test_empty_calls_returns_valid_response PASSED [ 29%]
tests/unit/services/test_optimization_service.py::TestBaselineMode::test_baseline_mode_without_date PASSED [ 30%]
tests/unit/services/test_optimization_service.py::TestBaselineMode::test_baseline_calculates_metrics FAILED [ 31%]
tests/unit/services/test_optimization_service.py::TestBaselineMode::test_baseline_calculates_cache_hit_rate PASSED [ 31%]
tests/unit/services/test_optimization_service.py::TestBaselineMode::test_baseline_calculates_error_rate PASSED [ 32%]
tests/unit/services/test_optimization_service.py::TestBaselineDetailTable::test_baseline_detail_table_groups_by_operation PASSED [ 33%]
tests/unit/services/test_optimization_service.py::TestBaselineDetailTable::test_baseline_detail_table_sorted_by_cost PASSED [ 33%]
tests/unit/services/test_optimization_service.py::TestImpactMode::test_impact_mode_with_date PASSED [ 34%]
tests/unit/services/test_optimization_service.py::TestImpactMode::test_splits_calls_before_after PASSED [ 35%]
tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_cost_savings FAILED [ 35%]
tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_latency_reduction PASSED [ 36%]
tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_quality_improvement PASSED [ 36%]
tests/unit/services/test_optimization_service.py::TestImpactInsufficientData::test_falls_back_to_baseline_no_before_data PASSED [ 37%]
tests/unit/services/test_optimization_service.py::TestImpactInsufficientData::test_falls_back_to_baseline_no_after_data PASSED [ 38%]
tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_perfect_health_all_improvements PASSED [ 38%]
tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_good_health_cost_and_latency_improvements PASSED [ 39%]
tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_warning_status_no_improvements PASSED [ 40%]
tests/unit/services/test_optimization_service.py::TestOptimizationObject::test_optimization_has_required_fields PASSED [ 40%]
tests/unit/services/test_optimization_service.py::TestSummaryMetrics::test_summary_total_optimizations PASSED [ 41%]
tests/unit/services/test_optimization_service.py::TestSummaryMetrics::test_summary_aggregates_savings PASSED [ 42%]
tests/unit/services/test_optimization_service.py::TestBaselineChartData::test_baseline_chart_data_limited_to_10 PASSED [ 42%]
tests/unit/services/test_optimization_service.py::TestBaselineChartData::test_baseline_chart_data_structure PASSED [ 43%]
tests/unit/services/test_optimization_service.py::TestFormatting::test_baseline_formats_cost PASSED [ 43%]
tests/unit/services/test_optimization_service.py::TestFormatting::test_baseline_formats_latency PASSED [ 44%]
tests/unit/services/test_optimization_service.py::TestFormatting::test_baseline_formats_percentages PASSED [ 45%]
tests/unit/services/test_optimization_service.py::TestEdgeCases::test_handles_zero_latency_in_before PASSED [ 45%]
tests/unit/services/test_optimization_service.py::TestEdgeCases::test_handles_missing_quality_scores PASSED [ 46%]
tests/unit/services/test_prompt_service.py::TestPromptSummaryEmpty::test_empty_calls_returns_valid_response FAILED [ 47%]
tests/unit/services/test_prompt_service.py::TestPromptSummaryEmpty::test_filters_non_llm_calls FAILED [ 47%]
tests/unit/services/test_prompt_service.py::TestPromptBreakdown::test_uses_prompt_breakdown_when_available FAILED [ 48%]
tests/unit/services/test_prompt_service.py::TestPromptBreakdown::test_estimates_when_breakdown_missing FAILED [ 49%]
tests/unit/services/test_prompt_service.py::TestDetailTable::test_groups_by_operation FAILED [ 49%]
tests/unit/services/test_prompt_service.py::TestDetailTable::test_calculates_averages_per_operation FAILED [ 50%]
tests/unit/services/test_prompt_service.py::TestDetailTable::test_calculates_system_prompt_percentage FAILED [ 50%]
tests/unit/services/test_prompt_service.py::TestDetailTable::test_sorted_by_redundant_tokens FAILED [ 51%]
tests/unit/services/test_prompt_service.py::TestRedundantTokenCalculation::test_calculates_redundant_tokens FAILED [ 52%]
tests/unit/services/test_prompt_service.py::TestRedundantTokenCalculation::test_single_call_has_no_redundancy FAILED [ 52%]
tests/unit/services/test_prompt_service.py::TestWasteDetection::test_high_system_prompt_percentage_flagged FAILED [ 53%]
tests/unit/services/test_prompt_service.py::TestWasteDetection::test_large_system_prompt_flagged FAILED [ 54%]
tests/unit/services/test_prompt_service.py::TestWasteDetection::test_efficient_prompt_not_flagged FAILED [ 54%]
tests/unit/services/test_prompt_service.py::TestStatusIndicators::test_red_status_for_waste FAILED [ 55%]
tests/unit/services/test_prompt_service.py::TestStatusIndicators::test_green_status_for_efficient FAILED [ 56%]
tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_calculates_total_system_tokens FAILED [ 56%]
tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_identifies_largest_system_prompt FAILED [ 57%]
tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_calculates_average_tokens FAILED [ 57%]
tests/unit/services/test_prompt_service.py::TestTopOffender::test_identifies_most_redundant_tokens FAILED [ 58%]
tests/unit/services/test_prompt_service.py::TestTopOffender::test_top_offender_includes_recommendation FAILED [ 59%]
tests/unit/services/test_prompt_service.py::TestTopOffender::test_no_top_offender_without_waste FAILED [ 59%]
tests/unit/services/test_prompt_service.py::TestRecommendations::test_compress_recommendation_for_large_prompts FAILED [ 60%]
tests/unit/services/test_prompt_service.py::TestRecommendations::test_caching_recommendation_for_repeated_prompts FAILED [ 61%]
tests/unit/services/test_prompt_service.py::TestHealthScore::test_perfect_health_efficient_prompts FAILED [ 61%]
tests/unit/services/test_prompt_service.py::TestHealthScore::test_warning_status_moderate_waste FAILED [ 62%]
tests/unit/services/test_prompt_service.py::TestHealthScore::test_error_status_severe_waste FAILED [ 63%]
tests/unit/services/test_prompt_service.py::TestChartData::test_chart_data_limited_to_10 FAILED [ 63%]
tests/unit/services/test_prompt_service.py::TestChartData::test_chart_data_structure FAILED [ 64%]
tests/unit/services/test_quality_service.py::TestQualitySummaryEmpty::test_empty_calls_returns_valid_response FAILED [ 64%]
tests/unit/services/test_quality_service.py::TestErrorDetection::test_counts_failed_calls FAILED [ 65%]
tests/unit/services/test_quality_service.py::TestErrorDetection::test_error_with_message FAILED [ 66%]
tests/unit/services/test_quality_service.py::TestErrorDetection::test_calculates_success_rate FAILED [ 66%]
tests/unit/services/test_quality_service.py::TestHallucinationDetection::test_counts_hallucinations FAILED [ 67%]
tests/unit/services/test_quality_service.py::TestHallucinationDetection::test_hallucination_flag FAILED [ 68%]
tests/unit/services/test_quality_service.py::TestQualityScores::test_calculates_average_quality_score FAILED [ 68%]
tests/unit/services/test_quality_service.py::TestQualityScores::test_ignores_calls_without_quality_eval FAILED [ 69%]
tests/unit/services/test_quality_service.py::TestQualityScores::test_handles_missing_judge_score FAILED [ 70%]
tests/unit/services/test_quality_service.py::TestDetailTable::test_groups_by_operation FAILED [ 70%]
tests/unit/services/test_quality_service.py::TestDetailTable::test_counts_errors_per_operation FAILED [ 71%]
tests/unit/services/test_quality_service.py::TestDetailTable::test_calculates_quality_metrics_per_operation FAILED [ 71%]
tests/unit/services/test_quality_service.py::TestDetailTable::test_status_indicators FAILED [ 72%]
tests/unit/services/test_quality_service.py::TestDetailTable::test_sorted_by_error_count FAILED [ 73%]
tests/unit/services/test_quality_service.py::TestOperationsAffected::test_counts_operations_with_errors FAILED [ 73%]
tests/unit/services/test_quality_service.py::TestTopOffender::test_identifies_most_errors FAILED [ 74%]
tests/unit/services/test_quality_service.py::TestTopOffender::test_top_offender_includes_quality_score FAILED [ 75%]
tests/unit/services/test_quality_service.py::TestTopOffender::test_no_top_offender_without_issues FAILED [ 75%]
tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_warning_threshold FAILED [ 76%]
tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_critical_threshold FAILED [ 77%]
tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_below_warning_threshold FAILED [ 77%]
tests/unit/services/test_quality_service.py::TestHealthScore::test_perfect_health_no_errors FAILED [ 78%]
tests/unit/services/test_quality_service.py::TestHealthScore::test_health_degrades_with_critical_error_rate FAILED [ 78%]
tests/unit/services/test_quality_service.py::TestHealthScore::test_health_degrades_with_warnings FAILED [ 79%]
tests/unit/services/test_quality_service.py::TestChartData::test_chart_data_limited_to_10 FAILED [ 80%]
tests/unit/services/test_quality_service.py::TestChartData::test_chart_data_structure FAILED [ 80%]
tests/unit/services/test_quality_service.py::TestMixedQualityIssues::test_quality_issue_calls_fixture FAILED [ 81%]
tests/unit/services/test_routing_service.py::test_routing_service PASSED [ 82%]
tests/unit/services/test_token_service.py::TestTokenSummaryEmpty::test_empty_calls_returns_valid_response FAILED [ 82%]
tests/unit/services/test_token_service.py::TestTokenSummaryEmpty::test_non_llm_calls_filtered_out FAILED [ 83%]
tests/unit/services/test_token_service.py::TestRatioCalculation::test_calculates_prompt_to_completion_ratio FAILED [ 84%]
tests/unit/services/test_token_service.py::TestRatioCalculation::test_average_ratio_calculation FAILED [ 84%]
tests/unit/services/test_token_service.py::TestRatioCalculation::test_worst_ratio_identification FAILED [ 85%]
tests/unit/services/test_token_service.py::TestRatioCalculation::test_zero_completion_tokens_handled FAILED [ 85%]
tests/unit/services/test_token_service.py::TestDetailTable::test_groups_by_operation FAILED [ 86%]
tests/unit/services/test_token_service.py::TestDetailTable::test_calculates_averages_per_operation FAILED [ 87%]
tests/unit/services/test_token_service.py::TestDetailTable::test_status_indicators FAILED [ 87%]
tests/unit/services/test_token_service.py::TestDetailTable::test_sorted_by_ratio_descending FAILED [ 88%]
tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_warning_threshold_detection FAILED [ 89%]
tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_critical_threshold_detection FAILED [ 89%]
tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_mixed_thresholds FAILED [ 90%]
tests/unit/services/test_token_service.py::TestTopOffender::test_identifies_worst_ratio FAILED [ 91%]
tests/unit/services/test_token_service.py::TestTopOffender::test_top_offender_includes_diagnosis FAILED [ 91%]
tests/unit/services/test_token_service.py::TestTopOffender::test_no_top_offender_when_balanced FAILED [ 92%]
tests/unit/services/test_token_service.py::TestDiagnosis::test_diagnoses_large_context_minimal_output FAILED [ 92%]
tests/unit/services/test_token_service.py::TestDiagnosis::test_diagnoses_moderate_imbalance FAILED [ 93%]
tests/unit/services/test_token_service.py::TestHealthScore::test_perfect_health_balanced_ratios FAILED [ 94%]
tests/unit/services/test_token_service.py::TestHealthScore::test_health_degrades_with_warnings FAILED [ 94%]
tests/unit/services/test_token_service.py::TestHealthScore::test_health_degrades_more_with_critical FAILED [ 95%]
tests/unit/services/test_token_service.py::TestHealthScore::test_health_floors_at_30 FAILED [ 96%]
tests/unit/services/test_token_service.py::TestChartData::test_chart_data_limited_to_10 FAILED [ 96%]
tests/unit/services/test_token_service.py::TestChartData::test_chart_data_structure FAILED [ 97%]
tests/unit/services/test_token_service.py::TestTokenFormatting::test_formats_token_counts FAILED [ 98%]
tests/unit/services/test_token_service.py::TestTokenFormatting::test_formats_ratio_string FAILED [ 98%]
tests/unit/services/test_token_service.py::TestImbalanceCounting::test_counts_imbalanced_operations FAILED [ 99%]
tests/unit/services/test_token_service.py::TestImbalanceCounting::test_issue_count_matches_imbalanced_count FAILED [100%]

================================== FAILURES ===================================
____________ TestDuplicateDetection.test_whitespace_normalization _____________
tests\unit\services\test_cache_service.py:101: in test_whitespace_normalization
    assert result.summary.duplicate_prompts >= 3
E   AssertionError: assert 2 >= 3
E    +  where 2 = CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01).duplicate_prompts
E    +    where CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01) = CacheStoryResponse(status='error', health_score=60.0, summary=CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01), top_offender=TopOffender(agent='TestAgent', operation='search', value=0.01, value_formatted='$0.010', call_count=3, diagnosis='2 duplicate calls wasting $0.010'), detail_table=[{'status': '\U0001f534', 'operation': 'TestAgent.search', 'total_calls': 3, 'unique_prompts': 2, 'duplicate_count': 2, 'redundancy_pct': 0.6666666666666666, 'redundancy_formatted': '66.7%', 'wasted_cost': 0.01, 'wasted_cost_formatted': '$0.010', 'has_opportunity': True}], chart_data=[{'name': 'TestAgent.search', 'duplicates': 2, 'wasted_cost': 0.01}], recommendations=[{'title': 'Enable prompt caching', 'description': 'Cache repeated prompts with semantic similarity matching', 'impact': 'High'}, {'title': 'Normalize prompts', 'description': 'Remove variable content before caching (timestamps, IDs)', 'impact': 'Medium'}, {'title': 'Set appropriate TTL', 'description': 'Configure cache expiration based on data freshness needs', 'impact': 'Low'}]).summary
___________________ TestDetailTable.test_status_indicators ____________________
tests\unit\services\test_cache_service.py:167: in test_status_indicators
    assert statuses["Agent.med"] == "\U0001f7e1"
E   AssertionError: assert '\U0001f534' == '\U0001f7e1'
E     
E     - \U0001f7e1
E     + \U0001f534
___________ TestHealthScore.test_perfect_health_with_good_hit_rate ____________
tests\unit\services\test_cache_service.py:254: in test_perfect_health_with_good_hit_rate
    assert result.health_score == 100.0
E   AssertionError: assert 85.0 == 100.0
E    +  where 85.0 = CacheStoryResponse(status='warning', health_score=85.0, summary=CacheSummary(total_calls=2, issue_count=1, cache_hits=2, cache_misses=0, hit_rate=1.0, hit_rate_formatted='100.0%', duplicate_prompts=2, potential_savings=0.01), top_offender=TopOffender(agent='TestAgent', operation='test_operation', value=0.01, value_formatted='$0.010', call_count=2, diagnosis='2 duplicate calls wasting $0.010'), detail_table=[{'status': '\U0001f534', 'operation': 'TestAgent.test_operation', 'total_calls': 2, 'unique_prompts': 1, 'duplicate_count': 2, 'redundancy_pct': 1.0, 'redundancy_formatted': '100.0%', 'wasted_cost': 0.01, 'wasted_cost_formatted': '$0.010', 'has_opportunity': True}], chart_data=[{'name': 'TestAgent.test_operation', 'duplicates': 2, 'wasted_cost': 0.01}], recommendations=[{'title': 'Enable prompt caching', 'description': 'Cache repeated prompts with semantic similarity matching', 'impact': 'High'}, {'title': 'Normalize prompts', 'description': 'Remove variable content before caching (timestamps, IDs)', 'impact': 'Medium'}, {'title': 'Set appropriate TTL', 'description': 'Configure cache expiration based on data freshness needs', 'impact': 'Low'}]).health_score
______________ TestBaselineMode.test_baseline_calculates_metrics ______________
tests\unit\services\test_optimization_service.py:61: in test_baseline_calculates_metrics
    assert result.baseline.total_cost == 0.30
E   AssertionError: assert 0.30000000000000004 == 0.3
E    +  where 0.30000000000000004 = BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%').total_cost
E    +    where BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%') = OptimizationStoryResponse(mode='baseline', status='ok', health_score=100.0, summary=OptimizationSummary(total_optimizations=0, total_cost_saved=0.0, total_latency_reduction=0.0, avg_quality_improvement=0.0), baseline=BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%'), optimizations=[], detail_table=[{'operation': 'TestAgent.test_operation', 'call_count': 2, 'avg_latency_ms': 1500.0, 'avg_latency': '1.5s', 'total_cost': 0.30000000000000004, 'total_cost_formatted': '$0.300'}], chart_data=[{'name': 'TestAgent.test_operation', 'latency': 1500.0, 'cost': 0.30000000000000004}], recommendations=[{'title': 'Optimize high-cost operations', 'description': 'Focus optimization efforts on the top 3 cost contributors', 'impact': 'High'}, {'title': 'Implement model routing', 'description': 'Route simple requests to cheaper models automatically', 'impact': 'High'}, {'title': 'Reduce prompt size', 'description': 'Compress or summarize context to reduce input tokens', 'impact': 'Medium'}]).baseline
_________________ TestImpactMode.test_calculates_cost_savings _________________
tests\unit\services\test_optimization_service.py:180: in test_calculates_cost_savings
    assert optimization.cost_saved == 0.10
E   AssertionError: assert 0.09999999999999998 == 0.1
E    +  where 0.09999999999999998 = OptimizationImpactSimple(id='optimization_1', name='Optimization Deployed', target_operation='all', implemented_date=datetime.datetime(2025, 12, 13, 2, 25, 23, 987446), before_avg_latency_ms=1000.0, before_total_cost=0.3, before_avg_quality=0.0, after_avg_latency_ms=1000.0, after_total_cost=0.2, after_avg_quality=0.0, cost_saved=0.09999999999999998, latency_reduction_pct=0.0, quality_improvement=0.0).cost_saved
_______ TestPromptSummaryEmpty.test_empty_calls_returns_valid_response ________
tests\unit\services\test_prompt_service.py:21: in test_empty_calls_returns_valid_response
    result = get_summary(empty_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:36: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
______________ TestPromptSummaryEmpty.test_filters_non_llm_calls ______________
tests\unit\services\test_prompt_service.py:41: in test_filters_non_llm_calls
    make_call_dict(prompt_tokens=None),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\fixtures\sample_calls.py:227: in make_call_dict
    total_tokens = prompt_tokens + completion_tokens
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'
________ TestPromptBreakdown.test_uses_prompt_breakdown_when_available ________
tests\unit\services\test_prompt_service.py:67: in test_uses_prompt_breakdown_when_available
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestPromptBreakdown.test_estimates_when_breakdown_missing __________
tests\unit\services\test_prompt_service.py:85: in test_estimates_when_breakdown_missing
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:202: in get_summary
    avg_user = sum(c.get('prompt_breakdown', {}).get('user_message_tokens', 0) for c in llm_calls) / len(llm_calls)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:202: in <genexpr>
    avg_user = sum(c.get('prompt_breakdown', {}).get('user_message_tokens', 0) for c in llm_calls) / len(llm_calls)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'get'
__________________ TestDetailTable.test_groups_by_operation ___________________
tests\unit\services\test_prompt_service.py:118: in test_groups_by_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestDetailTable.test_calculates_averages_per_operation ____________
tests\unit\services\test_prompt_service.py:150: in test_calculates_averages_per_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestDetailTable.test_calculates_system_prompt_percentage ___________
tests\unit\services\test_prompt_service.py:168: in test_calculates_system_prompt_percentage
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestDetailTable.test_sorted_by_redundant_tokens _______________
tests\unit\services\test_prompt_service.py:193: in test_sorted_by_redundant_tokens
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______ TestRedundantTokenCalculation.test_calculates_redundant_tokens ________
tests\unit\services\test_prompt_service.py:226: in test_calculates_redundant_tokens
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
______ TestRedundantTokenCalculation.test_single_call_has_no_redundancy _______
tests\unit\services\test_prompt_service.py:244: in test_single_call_has_no_redundancy
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________ TestWasteDetection.test_high_system_prompt_percentage_flagged ________
tests\unit\services\test_prompt_service.py:264: in test_high_system_prompt_percentage_flagged
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestWasteDetection.test_large_system_prompt_flagged _____________
tests\unit\services\test_prompt_service.py:281: in test_large_system_prompt_flagged
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestWasteDetection.test_efficient_prompt_not_flagged _____________
tests\unit\services\test_prompt_service.py:298: in test_efficient_prompt_not_flagged
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestStatusIndicators.test_red_status_for_waste ________________
tests\unit\services\test_prompt_service.py:319: in test_red_status_for_waste
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestStatusIndicators.test_green_status_for_efficient _____________
tests\unit\services\test_prompt_service.py:335: in test_green_status_for_efficient
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestGlobalMetrics.test_calculates_total_system_tokens ____________
tests\unit\services\test_prompt_service.py:361: in test_calculates_total_system_tokens
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestGlobalMetrics.test_identifies_largest_system_prompt ___________
tests\unit\services\test_prompt_service.py:382: in test_identifies_largest_system_prompt
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
______________ TestGlobalMetrics.test_calculates_average_tokens _______________
tests\unit\services\test_prompt_service.py:411: in test_calculates_average_tokens
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestTopOffender.test_identifies_most_redundant_tokens ____________
tests\unit\services\test_prompt_service.py:438: in test_identifies_most_redundant_tokens
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestTopOffender.test_top_offender_includes_recommendation __________
tests\unit\services\test_prompt_service.py:454: in test_top_offender_includes_recommendation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestTopOffender.test_no_top_offender_without_waste ______________
tests\unit\services\test_prompt_service.py:471: in test_no_top_offender_without_waste
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____ TestRecommendations.test_compress_recommendation_for_large_prompts ______
tests\unit\services\test_prompt_service.py:490: in test_compress_recommendation_for_large_prompts
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____ TestRecommendations.test_caching_recommendation_for_repeated_prompts _____
tests\unit\services\test_prompt_service.py:506: in test_caching_recommendation_for_repeated_prompts
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestHealthScore.test_perfect_health_efficient_prompts ____________
tests\unit\services\test_prompt_service.py:527: in test_perfect_health_efficient_prompts
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestHealthScore.test_warning_status_moderate_waste ______________
tests\unit\services\test_prompt_service.py:543: in test_warning_status_moderate_waste
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestHealthScore.test_error_status_severe_waste ________________
tests\unit\services\test_prompt_service.py:559: in test_error_status_severe_waste
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestChartData.test_chart_data_limited_to_10 _________________
tests\unit\services\test_prompt_service.py:581: in test_chart_data_limited_to_10
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ TestChartData.test_chart_data_structure ___________________
tests\unit\services\test_prompt_service.py:600: in test_chart_data_structure
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\prompt_service.py:208: in get_summary
    summary=SystemPromptSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
E   avg_total_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   system_token_pct_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   wasted_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______ TestQualitySummaryEmpty.test_empty_calls_returns_valid_response _______
tests\unit\services\test_quality_service.py:21: in test_empty_calls_returns_valid_response
    result = get_summary(empty_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:36: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 0, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestErrorDetection.test_counts_failed_calls _________________
tests\unit\services\test_quality_service.py:50: in test_counts_failed_calls
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestErrorDetection.test_error_with_message __________________
tests\unit\services\test_quality_service.py:63: in test_error_with_message
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestErrorDetection.test_calculates_success_rate _______________
tests\unit\services\test_quality_service.py:76: in test_calculates_success_rate
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestHallucinationDetection.test_counts_hallucinations ____________
tests\unit\services\test_quality_service.py:87: in test_counts_hallucinations
    result = get_summary(quality_issue_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestHallucinationDetection.test_hallucination_flag ______________
tests\unit\services\test_quality_service.py:103: in test_hallucination_flag
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestQualityScores.test_calculates_average_quality_score ___________
tests\unit\services\test_quality_service.py:119: in test_calculates_average_quality_score
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestQualityScores.test_ignores_calls_without_quality_eval __________
tests\unit\services\test_quality_service.py:131: in test_ignores_calls_without_quality_eval
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestQualityScores.test_handles_missing_judge_score ______________
tests\unit\services\test_quality_service.py:142: in test_handles_missing_judge_score
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________________ TestDetailTable.test_groups_by_operation ___________________
tests\unit\services\test_quality_service.py:158: in test_groups_by_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
______________ TestDetailTable.test_counts_errors_per_operation _______________
tests\unit\services\test_quality_service.py:173: in test_counts_errors_per_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________ TestDetailTable.test_calculates_quality_metrics_per_operation ________
tests\unit\services\test_quality_service.py:187: in test_calculates_quality_metrics_per_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ TestDetailTable.test_status_indicators ____________________
tests\unit\services\test_quality_service.py:205: in test_status_indicators
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestDetailTable.test_sorted_by_error_count __________________
tests\unit\services\test_quality_service.py:220: in test_sorted_by_error_count
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 8, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestOperationsAffected.test_counts_operations_with_errors __________
tests\unit\services\test_quality_service.py:239: in test_counts_operations_with_errors
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestTopOffender.test_identifies_most_errors _________________
tests\unit\services\test_quality_service.py:254: in test_identifies_most_errors
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 7, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 7, 'issue...operations_affected': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestTopOffender.test_top_offender_includes_quality_score ___________
tests\unit\services\test_quality_service.py:277: in test_top_offender_includes_quality_score
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestTopOffender.test_no_top_offender_without_issues _____________
tests\unit\services\test_quality_service.py:289: in test_no_top_offender_without_issues
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestErrorRateThresholds.test_warning_threshold ________________
tests\unit\services\test_quality_service.py:305: in test_warning_threshold
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestErrorRateThresholds.test_critical_threshold _______________
tests\unit\services\test_quality_service.py:318: in test_critical_threshold
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestErrorRateThresholds.test_below_warning_threshold _____________
tests\unit\services\test_quality_service.py:331: in test_below_warning_threshold
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________________ TestHealthScore.test_perfect_health_no_errors ________________
tests\unit\services\test_quality_service.py:347: in test_perfect_health_no_errors
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________ TestHealthScore.test_health_degrades_with_critical_error_rate ________
tests\unit\services\test_quality_service.py:359: in test_health_degrades_with_critical_error_rate
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestHealthScore.test_health_degrades_with_warnings ______________
tests\unit\services\test_quality_service.py:371: in test_health_degrades_with_warnings
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestChartData.test_chart_data_limited_to_10 _________________
tests\unit\services\test_quality_service.py:387: in test_chart_data_limited_to_10
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...perations_affected': 15}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 15, 'issu...perations_affected': 15}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ TestChartData.test_chart_data_structure ___________________
tests\unit\services\test_quality_service.py:397: in test_chart_data_structure
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 1, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestMixedQualityIssues.test_quality_issue_calls_fixture ___________
tests\unit\services\test_quality_service.py:410: in test_quality_issue_calls_fixture
    result = get_summary(quality_issue_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\quality_service.py:193: in get_summary
    summary=QualitySummary(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
E   evaluated_calls
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_quality_score_formatted
E     Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________ TestTokenSummaryEmpty.test_empty_calls_returns_valid_response ________
tests\unit\services\test_token_service.py:21: in test_empty_calls_returns_valid_response
    result = get_summary(empty_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:36: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestTokenSummaryEmpty.test_non_llm_calls_filtered_out ____________
tests\unit\services\test_token_service.py:38: in test_non_llm_calls_filtered_out
    make_call_dict(prompt_tokens=None, completion_tokens=0),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\fixtures\sample_calls.py:227: in make_call_dict
    total_tokens = prompt_tokens + completion_tokens
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'
_______ TestRatioCalculation.test_calculates_prompt_to_completion_ratio _______
tests\unit\services\test_token_service.py:55: in test_calculates_prompt_to_completion_ratio
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestRatioCalculation.test_average_ratio_calculation _____________
tests\unit\services\test_token_service.py:68: in test_average_ratio_calculation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestRatioCalculation.test_worst_ratio_identification _____________
tests\unit\services\test_token_service.py:79: in test_worst_ratio_identification
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestRatioCalculation.test_zero_completion_tokens_handled ___________
tests\unit\services\test_token_service.py:89: in test_zero_completion_tokens_handled
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________________ TestDetailTable.test_groups_by_operation ___________________
tests\unit\services\test_token_service.py:106: in test_groups_by_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestDetailTable.test_calculates_averages_per_operation ____________
tests\unit\services\test_token_service.py:120: in test_calculates_averages_per_operation
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ TestDetailTable.test_status_indicators ____________________
tests\unit\services\test_token_service.py:137: in test_status_indicators
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestDetailTable.test_sorted_by_ratio_descending _______________
tests\unit\services\test_token_service.py:152: in test_sorted_by_ratio_descending
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestImbalanceThresholds.test_warning_threshold_detection ___________
tests\unit\services\test_token_service.py:168: in test_warning_threshold_detection
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestImbalanceThresholds.test_critical_threshold_detection __________
tests\unit\services\test_token_service.py:181: in test_critical_threshold_detection
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________________ TestImbalanceThresholds.test_mixed_thresholds ________________
tests\unit\services\test_token_service.py:190: in test_mixed_thresholds
    result = get_summary(token_imbalance_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestTopOffender.test_identifies_worst_ratio _________________
tests\unit\services\test_token_service.py:208: in test_identifies_worst_ratio
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
____________ TestTopOffender.test_top_offender_includes_diagnosis _____________
tests\unit\services\test_token_service.py:225: in test_top_offender_includes_diagnosis
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestTopOffender.test_no_top_offender_when_balanced ______________
tests\unit\services\test_token_service.py:237: in test_no_top_offender_when_balanced
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________ TestDiagnosis.test_diagnoses_large_context_minimal_output __________
tests\unit\services\test_token_service.py:256: in test_diagnoses_large_context_minimal_output
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______________ TestDiagnosis.test_diagnoses_moderate_imbalance _______________
tests\unit\services\test_token_service.py:272: in test_diagnoses_moderate_imbalance
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestHealthScore.test_perfect_health_balanced_ratios _____________
tests\unit\services\test_token_service.py:288: in test_perfect_health_balanced_ratios
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_____________ TestHealthScore.test_health_degrades_with_warnings ______________
tests\unit\services\test_token_service.py:299: in test_health_degrades_with_warnings
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestHealthScore.test_health_degrades_more_with_critical ___________
tests\unit\services\test_token_service.py:310: in test_health_degrades_more_with_critical
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
__________________ TestHealthScore.test_health_floors_at_30 ___________________
tests\unit\services\test_token_service.py:323: in test_health_floors_at_30
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestChartData.test_chart_data_limited_to_10 _________________
tests\unit\services\test_token_service.py:343: in test_chart_data_limited_to_10
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ TestChartData.test_chart_data_structure ___________________
tests\unit\services\test_token_service.py:353: in test_chart_data_structure
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________________ TestTokenFormatting.test_formats_token_counts ________________
tests\unit\services\test_token_service.py:371: in test_formats_token_counts
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
________________ TestTokenFormatting.test_formats_ratio_string ________________
tests\unit\services\test_token_service.py:383: in test_formats_ratio_string
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________ TestImbalanceCounting.test_counts_imbalanced_operations ___________
tests\unit\services\test_token_service.py:394: in test_counts_imbalanced_operations
    result = get_summary(token_imbalance_calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_______ TestImbalanceCounting.test_issue_count_matches_imbalanced_count _______
tests\unit\services\test_token_service.py:406: in test_issue_count_matches_imbalanced_count
    result = get_summary(calls, project=None, days=7)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
api\services\token_service.py:176: in get_summary
    summary=TokenImbalanceSummary(
E   pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
E   avg_prompt_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   avg_completion_tokens
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   critical_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   warning_count
E     Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
============================== warnings summary ===============================
api\models\base.py:35
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:35: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ErrorResponse(BaseModel):

.venv\Lib\site-packages\pydantic\_internal\_config.py:383
  c:\Users\bjlol\Desktop\ai-agent-observatory\.venv\Lib\site-packages\pydantic\_internal\_config.py:383: UserWarning: Valid config keys have changed in V2:
  * 'schema_extra' has been renamed to 'json_schema_extra'
    warnings.warn(message, UserWarning)

api\models\base.py:71
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:71: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class PaginatedResponse(BaseModel, Generic[T]):

api\models\base.py:96
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:96: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class HealthResponse(BaseModel):

api\models\base.py:120
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:120: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SuccessResponse(BaseModel):

api\models\base.py:136
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:136: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class CreatedResponse(BaseModel):

api\models\base.py:154
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\base.py:154: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DeletedResponse(BaseModel):

api\models\llm_call.py:60
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\llm_call.py:60: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMCallResponse(BaseModel):

api\models\llm_call.py:151
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\llm_call.py:151: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMCallListResponse(BaseModel):

api\models\filters.py:26
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\filters.py:26: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('end_date')

api\models\metadata.py:56
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\metadata.py:56: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ProjectsResponse(BaseModel):

api\models\metadata.py:77
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\metadata.py:77: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ModelsResponse(BaseModel):

api\models\metadata.py:99
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\metadata.py:99: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgentsResponse(BaseModel):

api\models\metadata.py:121
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\metadata.py:121: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OperationsResponse(BaseModel):

api\models\responses.py:34
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\responses.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ChartDataPoint(BaseModel):

api\models\optimization.py:63
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\optimization.py:63: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OptimizationStoryResponse(BaseModel):

api\models\optimization.py:121
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\optimization.py:121: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OptimizationRecord(BaseModel):

api\models\optimization.py:193
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\optimization.py:193: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OptimizationImpact(BaseModel):

api\models\analytics.py:27
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\analytics.py:27: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TimeSeriesResponse(BaseModel):

api\models\analytics.py:67
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\analytics.py:67: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class MultiSeriesResponse(BaseModel):

api\models\analytics.py:90
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\analytics.py:90: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TrendAnalysis(BaseModel):

api\models\analytics.py:148
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\analytics.py:148: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ComparisonMetrics(BaseModel):

api\models\analytics.py:204
  C:\Users\bjlol\Desktop\ai-agent-observatory\api\models\analytics.py:204: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DistributionAnalysis(BaseModel):

tests/unit/services/test_cache_service.py: 186 warnings
tests/unit/services/test_latency_service.py: 77 warnings
tests/unit/services/test_optimization_service.py: 37 warnings
tests/unit/services/test_prompt_service.py: 130 warnings
tests/unit/services/test_quality_service.py: 581 warnings
tests/unit/services/test_token_service.py: 67 warnings
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\fixtures\sample_calls.py:234: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'timestamp': timestamp or datetime.utcnow(),

tests/unit/services/test_optimization_service.py::TestImpactMode::test_impact_mode_with_date
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:132: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactMode::test_splits_calls_before_after
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:148: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_cost_savings
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:169: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_latency_reduction
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:185: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_quality_improvement
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:201: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactInsufficientData::test_falls_back_to_baseline_no_before_data
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:227: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactInsufficientData::test_falls_back_to_baseline_no_after_data
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:241: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_perfect_health_all_improvements
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:259: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_good_health_cost_and_latency_improvements
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:286: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestImpactHealthScore::test_warning_status_no_improvements
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:309: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestOptimizationObject::test_optimization_has_required_fields
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:336: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestSummaryMetrics::test_summary_total_optimizations
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:364: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestSummaryMetrics::test_summary_aggregates_savings
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:378: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestEdgeCases::test_handles_zero_latency_in_before
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:462: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/unit/services/test_optimization_service.py::TestEdgeCases::test_handles_missing_quality_scores
  C:\Users\bjlol\Desktop\ai-agent-observatory\tests\unit\services\test_optimization_service.py:477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.12.10-final-0 _______________

Name                                   Stmts   Miss  Cover   Missing
--------------------------------------------------------------------
api\__init__.py                            2      0   100%
api\config\__init__.py                     4      0   100%
api\config\plugin_map.py                  48     29    40%   216-217, 231-232, 246-247, 261-262, 267, 272, 280, 288, 301-311, 333-334, 344-345, 350-351, 356-357
api\config\settings.py                    54     16    70%   127-130, 135, 140, 146-160
api\config\story_definitions.py           26     10    62%   426, 436, 441, 446, 451, 456-458, 463, 472
api\dependencies.py                        7      7     0%   15-40
api\main.py                               17      4    76%   58, 70, 82-83
api\models\__init__.py                    19      0   100%
api\models\alerts.py                      60      0   100%
api\models\analytics.py                   88      0   100%
api\models\base.py                        59      0   100%
api\models\batch.py                       32      0   100%
api\models\code_location.py               40      5    88%   21-26
api\models\conversation.py                47      0   100%
api\models\dashboard.py                   26      0   100%
api\models\experiment.py                  33      0   100%
api\models\filters.py                     80     14    82%   29-31, 35-50
api\models\llm_call.py                    88      0   100%
api\models\metadata.py                    64      0   100%
api\models\optimization.py               115      0   100%
api\models\responses.py                  102      0   100%
api\models\user_preferences.py            35      0   100%
api\models\webhooks.py                    62      0   100%
api\routers\__init__.py                    3      0   100%
api\routers\alerts.py                      2      2     0%   4-6
api\routers\analytics.py                   2      2     0%   4-6
api\routers\experiments.py                 2      2     0%   4-6
api\routers\llm_calls.py                  10     10     0%   6-30
api\routers\metadata.py                   19      5    74%   35, 51, 67, 83, 102
api\routers\optimizations.py               2      2     0%   4-6
api\routers\stories.py                    55     29    47%   51-54, 77-78, 96-97, 115-116, 134-135, 153-154, 172-173, 191-192, 214-227, 242-250
api\routers\webhooks.py                    2      2     0%   4-6
api\services\__init__.py                  10      0   100%
api\services\alert_service.py              0      0   100%
api\services\analytics_service.py          0      0   100%
api\services\batch_service.py              0      0   100%
api\services\cache_service.py             59      2    97%   144-145
api\services\cost_service.py              46     39    15%   31-152
api\services\dashboard_service.py          0      0   100%
api\services\experiment_service.py         0      0   100%
api\services\latency_service.py           68      0   100%
api\services\llm_call_service.py         136    130     4%   30-45, 114-257, 278-325
api\services\optimization_service.py      64      0   100%
api\services\prompt_service.py            85      1    99%   56
api\services\quality_service.py           69      0   100%
api\services\routing_service.py           74     66    11%   32-191
api\services\token_service.py             65      1    98%   55
api\services\webhook_service.py            0      0   100%
api\utils\__init__.py                      5      0   100%
api\utils\aggregators.py                 221    202     9%   27-29, 38-75, 80-118, 123-164, 169-172, 181-214, 231-271, 296-334, 359-392, 413-443, 452-477, 500-520, 533-565, 589-628
api\utils\data_fetcher.py                277    249    10%   48-71, 83-86, 92, 101-102, 107-108, 113-114, 119-120, 131-132, 182-219, 238-250, 263-495, 504-550, 569-578, 586-614, 622-660, 671-720, 733-785, 823-928, 951-964, 992-1005
api\utils\exceptions.py                   46     10    78%   20-22, 62, 72, 100, 119, 152, 172-185
api\utils\formatters.py                  100     72    28%   29, 63, 91-99, 114-133, 147-154, 167-176, 190, 204-208, 223-225, 239-259, 272-303
observatory\__init__.py                   12      1    92%   277
observatory\cache.py                     151    117    23%   46-48, 124-139, 164-174, 178, 202-214, 224-227, 231, 255-313, 337-381, 398-423, 427-432, 451, 465, 473-485, 498-502, 539
observatory\collector.py                 183    150    18%   56-58, 63-86, 105-108, 116-133, 142-168, 298-482, 499-508, 519-526, 537-544, 563-586, 596-637, 653-659, 678-681, 689, 693, 697, 701, 705, 709, 713, 717, 721
observatory\judge.py                     202    167    17%   65-76, 133-146, 154-155, 159-160, 164-165, 169-170, 188-200, 232-235, 263-266, 283-319, 330-364, 383-419, 438-469, 488-502, 556-601, 607-632, 636-641, 649-652, 667-670, 709
observatory\models.py                    340     42    88%   55-57, 62-64, 89-91, 134-136, 162-164, 185-187, 192-194, 217-219, 244-246, 251-253, 441-443, 448-450, 455-457, 462-464
observatory\prompts.py                   146    104    29%   46, 95-107, 143-179, 183, 187, 218-252, 256-264, 268-278, 282-293, 314-317, 334-337, 354-361, 369-373, 406, 423-442, 446, 450-452, 483, 534-547, 582-584
observatory\router.py                    147    112    24%   49-72, 138-155, 163, 207-221, 225-226, 254-305, 309-321, 325-326, 335-348, 364-409, 413, 420-421, 430, 438, 458-460, 493
observatory\storage.py                   331    195    41%   202-207, 214, 238, 267-328, 445-481, 575-581, 585-590, 598-604, 608-614, 633-674, 682-687, 691-702, 706-717, 721-732, 740-747, 756-772, 781-797
--------------------------------------------------------------------
TOTAL                                   4042   1799    55%
Coverage HTML written to dir htmlcov
=========================== short test summary info ===========================
FAILED tests/unit/services/test_cache_service.py::TestDuplicateDetection::test_whitespace_normalization - AssertionError: assert 2 >= 3
 +  where 2 = CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01).duplicate_prompts
 +    where CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01) = CacheStoryResponse(status='error', health_score=60.0, summary=CacheSummary(total_calls=3, issue_count=1, cache_hits=0, cache_misses=0, hit_rate=0.0, hit_rate_formatted='0.0%', duplicate_prompts=2, potential_savings=0.01), top_offender=TopOffender(agent='TestAgent', operation='search', value=0.01, value_formatted='$0.010', call_count=3, diagnosis='2 duplicate calls wasting $0.010'), detail_table=[{'status': '\U0001f534', 'operation': 'TestAgent.search', 'total_calls': 3, 'unique_prompts': 2, 'duplicate_count': 2, 'redundancy_pct': 0.6666666666666666, 'redundancy_formatted': '66.7%', 'wasted_cost': 0.01, 'wasted_cost_formatted': '$0.010', 'has_opportunity': True}], chart_data=[{'name': 'TestAgent.search', 'duplicates': 2, 'wasted_cost': 0.01}], recommendations=[{'title': 'Enable prompt caching', 'description': 'Cache repeated prompts with semantic similarity matching', 'impact': 'High'}, {'title': 'Normalize prompts', 'description': 'Remove variable content before caching (timestamps, IDs)', 'impact': 'Medium'}, {'title': 'Set appropriate TTL', 'description': 'Configure cache expiration based on data freshness needs', 'impact': 'Low'}]).summary
FAILED tests/unit/services/test_cache_service.py::TestDetailTable::test_status_indicators - AssertionError: assert '\U0001f534' == '\U0001f7e1'\n  \n  - \U0001f7e1\n  + \U0001f534
FAILED tests/unit/services/test_cache_service.py::TestHealthScore::test_perfect_health_with_good_hit_rate - AssertionError: assert 85.0 == 100.0
 +  where 85.0 = CacheStoryResponse(status='warning', health_score=85.0, summary=CacheSummary(total_calls=2, issue_count=1, cache_hits=2, cache_misses=0, hit_rate=1.0, hit_rate_formatted='100.0%', duplicate_prompts=2, potential_savings=0.01), top_offender=TopOffender(agent='TestAgent', operation='test_operation', value=0.01, value_formatted='$0.010', call_count=2, diagnosis='2 duplicate calls wasting $0.010'), detail_table=[{'status': '\U0001f534', 'operation': 'TestAgent.test_operation', 'total_calls': 2, 'unique_prompts': 1, 'duplicate_count': 2, 'redundancy_pct': 1.0, 'redundancy_formatted': '100.0%', 'wasted_cost': 0.01, 'wasted_cost_formatted': '$0.010', 'has_opportunity': True}], chart_data=[{'name': 'TestAgent.test_operation', 'duplicates': 2, 'wasted_cost': 0.01}], recommendations=[{'title': 'Enable prompt caching', 'description': 'Cache repeated prompts with semantic similarity matching', 'impact': 'High'}, {'title': 'Normalize prompts', 'description': 'Remove variable content before caching (timestamps, IDs)', 'impact': 'Medium'}, {'title': 'Set appropriate TTL', 'description': 'Configure cache expiration based on data freshness needs', 'impact': 'Low'}]).health_score
FAILED tests/unit/services/test_optimization_service.py::TestBaselineMode::test_baseline_calculates_metrics - AssertionError: assert 0.30000000000000004 == 0.3
 +  where 0.30000000000000004 = BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%').total_cost
 +    where BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%') = OptimizationStoryResponse(mode='baseline', status='ok', health_score=100.0, summary=OptimizationSummary(total_optimizations=0, total_cost_saved=0.0, total_latency_reduction=0.0, avg_quality_improvement=0.0), baseline=BaselineMetrics(total_calls=2, avg_latency_ms=1500.0, avg_latency='1.5s', total_cost=0.30000000000000004, total_cost_formatted='$0.300', avg_quality_score=8.5, cache_hit_rate=0.0, cache_hit_rate_formatted='0.0%', error_rate=0.0, error_rate_formatted='0.0%'), optimizations=[], detail_table=[{'operation': 'TestAgent.test_operation', 'call_count': 2, 'avg_latency_ms': 1500.0, 'avg_latency': '1.5s', 'total_cost': 0.30000000000000004, 'total_cost_formatted': '$0.300'}], chart_data=[{'name': 'TestAgent.test_operation', 'latency': 1500.0, 'cost': 0.30000000000000004}], recommendations=[{'title': 'Optimize high-cost operations', 'description': 'Focus optimization efforts on the top 3 cost contributors', 'impact': 'High'}, {'title': 'Implement model routing', 'description': 'Route simple requests to cheaper models automatically', 'impact': 'High'}, {'title': 'Reduce prompt size', 'description': 'Compress or summarize context to reduce input tokens', 'impact': 'Medium'}]).baseline
FAILED tests/unit/services/test_optimization_service.py::TestImpactMode::test_calculates_cost_savings - AssertionError: assert 0.09999999999999998 == 0.1
 +  where 0.09999999999999998 = OptimizationImpactSimple(id='optimization_1', name='Optimization Deployed', target_operation='all', implemented_date=datetime.datetime(2025, 12, 13, 2, 25, 23, 987446), before_avg_latency_ms=1000.0, before_total_cost=0.3, before_avg_quality=0.0, after_avg_latency_ms=1000.0, after_total_cost=0.2, after_avg_quality=0.0, cost_saved=0.09999999999999998, latency_reduction_pct=0.0, quality_improvement=0.0).cost_saved
FAILED tests/unit/services/test_prompt_service.py::TestPromptSummaryEmpty::test_empty_calls_returns_valid_response - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 0, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestPromptSummaryEmpty::test_filters_non_llm_calls - TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'
FAILED tests/unit/services/test_prompt_service.py::TestPromptBreakdown::test_uses_prompt_breakdown_when_available - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestPromptBreakdown::test_estimates_when_breakdown_missing - AttributeError: 'NoneType' object has no attribute 'get'
FAILED tests/unit/services/test_prompt_service.py::TestDetailTable::test_groups_by_operation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestDetailTable::test_calculates_averages_per_operation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestDetailTable::test_calculates_system_prompt_percentage - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestDetailTable::test_sorted_by_redundant_tokens - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 6, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestRedundantTokenCalculation::test_calculates_redundant_tokens - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..._redundant_tokens': 800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestRedundantTokenCalculation::test_single_call_has_no_redundancy - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestWasteDetection::test_high_system_prompt_percentage_flagged - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestWasteDetection::test_large_system_prompt_flagged - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestWasteDetection::test_efficient_prompt_not_flagged - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestStatusIndicators::test_red_status_for_waste - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestStatusIndicators::test_green_status_for_efficient - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_calculates_total_system_tokens - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_identifies_largest_system_prompt - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestGlobalMetrics::test_calculates_average_tokens - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..._redundant_tokens': 500}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestTopOffender::test_identifies_most_redundant_tokens - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 8, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestTopOffender::test_top_offender_includes_recommendation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 5, 'issue...redundant_tokens': 6400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestTopOffender::test_no_top_offender_without_waste - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestRecommendations::test_compress_recommendation_for_large_prompts - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue...redundant_tokens': 3200}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestRecommendations::test_caching_recommendation_for_repeated_prompts - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu...redundant_tokens': 8400}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestHealthScore::test_perfect_health_efficient_prompts - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestHealthScore::test_warning_status_moderate_waste - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestHealthScore::test_error_status_severe_waste - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 50, 'issu...edundant_tokens': 58800}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestChartData::test_chart_data_limited_to_10 - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_prompt_service.py::TestChartData::test_chart_data_structure - pydantic_core._pydantic_core.ValidationError: 4 validation errors for SystemPromptSummary
avg_total_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
system_token_pct_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
wasted_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue...al_redundant_tokens': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestQualitySummaryEmpty::test_empty_calls_returns_valid_response - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 0, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 0, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorDetection::test_counts_failed_calls - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorDetection::test_error_with_message - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorDetection::test_calculates_success_rate - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestHallucinationDetection::test_counts_hallucinations - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestHallucinationDetection::test_hallucination_flag - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestQualityScores::test_calculates_average_quality_score - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestQualityScores::test_ignores_calls_without_quality_eval - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestQualityScores::test_handles_missing_judge_score - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestDetailTable::test_groups_by_operation - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestDetailTable::test_counts_errors_per_operation - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestDetailTable::test_calculates_quality_metrics_per_operation - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 3, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestDetailTable::test_status_indicators - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestDetailTable::test_sorted_by_error_count - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 8, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 8, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestOperationsAffected::test_counts_operations_with_errors - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestTopOffender::test_identifies_most_errors - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 7, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 7, 'issue...operations_affected': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestTopOffender::test_top_offender_includes_quality_score - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestTopOffender::test_no_top_offender_without_issues - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_warning_threshold - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_critical_threshold - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestErrorRateThresholds::test_below_warning_threshold - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestHealthScore::test_perfect_health_no_errors - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 2, 'issue...operations_affected': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestHealthScore::test_health_degrades_with_critical_error_rate - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestHealthScore::test_health_degrades_with_warnings - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 100, 'iss...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestChartData::test_chart_data_limited_to_10 - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 15, 'issu...perations_affected': 15}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 15, 'issu...perations_affected': 15}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestChartData::test_chart_data_structure - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 1, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 1, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_quality_service.py::TestMixedQualityIssues::test_quality_issue_calls_fixture - pydantic_core._pydantic_core.ValidationError: 2 validation errors for QualitySummary
evaluated_calls
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_quality_score_formatted
  Field required [type=missing, input_value={'total_calls': 4, 'issue...operations_affected': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTokenSummaryEmpty::test_empty_calls_returns_valid_response - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 0, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTokenSummaryEmpty::test_non_llm_calls_filtered_out - TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'
FAILED tests/unit/services/test_token_service.py::TestRatioCalculation::test_calculates_prompt_to_completion_ratio - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestRatioCalculation::test_average_ratio_calculation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestRatioCalculation::test_worst_ratio_identification - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestRatioCalculation::test_zero_completion_tokens_handled - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDetailTable::test_groups_by_operation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDetailTable::test_calculates_averages_per_operation - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDetailTable::test_status_indicators - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDetailTable::test_sorted_by_ratio_descending - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 3, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_warning_threshold_detection - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_critical_threshold_detection - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestImbalanceThresholds::test_mixed_thresholds - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTopOffender::test_identifies_worst_ratio - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTopOffender::test_top_offender_includes_diagnosis - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTopOffender::test_no_top_offender_when_balanced - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDiagnosis::test_diagnoses_large_context_minimal_output - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestDiagnosis::test_diagnoses_moderate_imbalance - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestHealthScore::test_perfect_health_balanced_ratios - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestHealthScore::test_health_degrades_with_warnings - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestHealthScore::test_health_degrades_more_with_critical - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestHealthScore::test_health_floors_at_30 - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 10, 'issu... 'imbalanced_count': 10}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestChartData::test_chart_data_limited_to_10 - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 15, 'issu... 'imbalanced_count': 14}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestChartData::test_chart_data_structure - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTokenFormatting::test_formats_token_counts - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestTokenFormatting::test_formats_ratio_string - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 1, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestImbalanceCounting::test_counts_imbalanced_operations - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 4, 'issue..., 'imbalanced_count': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/unit/services/test_token_service.py::TestImbalanceCounting::test_issue_count_matches_imbalanced_count - pydantic_core._pydantic_core.ValidationError: 4 validation errors for TokenImbalanceSummary
avg_prompt_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
avg_completion_tokens
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
critical_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
warning_count
  Field required [type=missing, input_value={'total_calls': 2, 'issue..., 'imbalanced_count': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
================ 88 failed, 69 passed, 1116 warnings in 8.35s =================
